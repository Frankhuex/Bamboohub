import{_ as E,r as i,o as U,a as s,c as p,b as a,t as _,w as D,d as I,v as $,i as C,e as O,F as M,f as S,u as T,g as R,h as K}from"./index-BeOy6nZZ.js";import{a as f,B as m}from"./constants-DUOyrFO1.js";const j={key:0,class:"paragraph-cell"},q={key:0,class:"paragraph"},z={key:0},G={class:"content"},H={key:1},J={key:2},Q={__name:"ParagraphCell",props:["paraId"],emits:["loadedNextParaId","addedParagraph","deletedParagraph","movedUpParagraph","movedDownParagraph"],setup(k,{emit:b}){const P=k,o=b,y=i(!0),l=i({id:null,bookId:-1,author:"",content:"",prevParaId:null,nextParaId:null}),w=i(!1),x=i(""),g=i(!1),d=i(""),u=i(""),h=i(!1);U(async()=>{try{y.value=!0;const e=await f.get(`${m}/paragraph/${P.paraId}`);l.value=e.data.data,w.value=e.data.success,x.value=e.data.errorMsg,e.data.data.nextParaId&&o("loadedNextParaId",e.data.data.nextParaId)}catch(e){console.log(e)}finally{y.value=!1}});const r=()=>{d.value=l.value.author,u.value=l.value.content,g.value=!0},n=async()=>{try{l.value.author=d.value,l.value.content=u.value;const e=await f.put(`${m}/paragraph/${l.value.id}`,{author:d.value,content:u.value});e.data.success?(console.log("Paragraph updated successfully!"),console.log(e.data.data),g.value=!1):console.log("Failed to update paragraph:",e.data.errorMsg)}catch(e){console.error("Error submitting edit:",e)}},c=()=>{g.value=!1},B=()=>{d.value="",u.value="",h.value=!0},N=async()=>{try{const e=await f.post(`${m}/paragraph`,{author:d.value,content:u.value,prevParaId:l.value.id});e.data.success?(console.log("Paragraph added successfully!"),console.log(e.data.data),h.value=!1,o("addedParagraph",{id:e.data.data,prevParaId:l.value.id})):console.log("Failed to add paragraph:",e.data.errorMsg)}catch(e){console.error("Error submitting new paragraph:",e)}},L=()=>{h.value=!1},V=async()=>{if(window.confirm(`你确定要删除${l.value.author}写的这一段吗？`))try{const t=await f.delete(`${m}/paragraph/${l.value.id}`);t.data.success?(console.log("Paragraph deleted successfully!"),console.log(t.data.data),o("deletedParagraph",l.value.id)):console.log("Failed to delete paragraph:",t.data.errorMsg)}catch(t){console.error("Error deleting paragraph:",t)}},A=async()=>{try{(await f.put(`${m}/paragraph/${l.value.id}/move-up`)).data.success&&(console.log("Paragraph moved up successfully!"),o("movedUpParagraph",l.value.id))}catch(e){console.error("Error moving up paragraph:",e)}},F=async()=>{try{(await f.put(`${m}/paragraph/${l.value.id}/move-down`)).data.success&&(console.log("Paragraph moved down successfully!"),o("movedDownParagraph",l.value.id))}catch(e){console.error("Error moving down paragraph:",e)}};return(e,t)=>w.value?(s(),p("div",j,[l.value.prevParaId?(s(),p("div",q,[g.value?(s(),p("form",{key:1,onSubmit:D(n,["prevent"])},[a("div",null,[t[5]||(t[5]=a("label",{for:"author"},"作者:",-1)),I(a("input",{"onUpdate:modelValue":t[1]||(t[1]=v=>d.value=v),type:"text",id:"author"},null,512),[[$,d.value]])]),a("div",null,[t[6]||(t[6]=a("label",{for:"content"},"文本:",-1)),I(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=v=>u.value=v),rows:"4",cols:"50"},null,512),[[$,u.value]])]),a("div",null,[a("button",{type:"button",onClick:c},"取消"),t[7]||(t[7]=a("button",{type:"submit"},"提交",-1))])],32)):(s(),p("div",z,[a("p",{class:"author",onClick:t[0]||(t[0]=v=>e.$emit("clickEditAuthor"))},_(l.value.author),1),a("article",null,[a("p",G,_(l.value.content),1)]),a("button",{onClick:r},"编辑"),a("button",{onClick:V},"删除"),a("button",{onClick:A},"上移"),a("button",{onClick:F},"下移")]))])):C("",!0),a("div",null,[!g.value&&!h.value?(s(),p("button",{key:0,class:"btn-add-para",onClick:B}," + ")):C("",!0),h.value?(s(),p("form",{key:1,class:"paragraph",onSubmit:D(N,["prevent"])},[a("div",null,[t[8]||(t[8]=a("label",{for:"author"},"作者:",-1)),I(a("input",{"onUpdate:modelValue":t[3]||(t[3]=v=>d.value=v),type:"text",id:"author"},null,512),[[$,d.value]])]),a("div",null,[t[9]||(t[9]=a("label",{for:"content"},"文本:",-1)),I(a("textarea",{"onUpdate:modelValue":t[4]||(t[4]=v=>u.value=v),rows:"4",cols:"50"},null,512),[[$,u.value]])]),a("div",null,[a("button",{type:"button",onClick:L},"取消"),t[10]||(t[10]=a("button",{type:"submit"},"提交",-1))])],32)):C("",!0)]),O(e.$slots,"default",{},void 0)])):y.value?(s(),p("div",H,"Loading...")):(s(),p("div",J,"Failed to load..."))}},W=E(Q,[["__scopeId","data-v-334315a0"]]),X={class:"book-info"},Y={class:"paragraphs"},Z={__name:"ParagraphList",props:["bookId"],setup(k){const b=k,P=i({id:null,title:"",startParaId:null}),o=i([]),y=i(!1),l=T(),w=()=>{l.push({name:"BookList"})};U(async()=>{try{y.value=!0;let r=await f.get(`${m}/book/${b.bookId}`);r.data.success&&(P.value=r.data.data,o.value.push(P.value.startParaId))}catch(r){console.log(r)}});function x(r){r&&!o.value.includes(r)&&o.value.push(r)}function g(r){let n=o.value.indexOf(r.prevParaId);o.value.splice(n+1,0,r.id)}function d(r){let n=o.value.indexOf(r);o.value.splice(n,1)}function u(r){let n=o.value.indexOf(r);if(n>0){let c=o.value[n-1];o.value[n-1]=r,o.value[n]=c}}function h(r){let n=o.value.indexOf(r);if(n<o.value.length-1){let c=o.value[n+1];o.value[n+1]=r,o.value[n]=c}}return(r,n)=>(s(),p(M,null,[a("div",X,[a("h1",null,_(P.value.title),1),a("button",{onClick:w},"回到首页"),n[0]||(n[0]=a("p",null,[a("br")],-1))]),a("div",Y,[(s(!0),p(M,null,S(o.value,c=>(s(),R(W,{key:c,paraId:c,onLoadedNextParaId:x,onAddedParagraph:g,onDeletedParagraph:d,onMovedUpParagraph:u,onMovedDownParagraph:h},null,8,["paraId"]))),128))])],64))}},aa=E(Z,[["__scopeId","data-v-4c711dea"]]),oa={__name:"BookView",setup(k){return(b,P)=>(s(),p("div",null,[K(aa,{bookId:b.$route.params.bookId},null,8,["bookId"])]))}};export{oa as default};
